<!doctype html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>ÙŠÙˆØ³Ù ÙˆØ§ Ù…ÙƒØ§Ø±ÙŠÙˆØ³ â€” Ù…Ù†ØµØ© Ø§Ù„Ø¨Ø±ÙˆÙ…Ø¨ØªØ§Øª</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans+Arabic:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        /* 1. Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª ÙˆØ§Ù„Ø£Ù„ÙˆØ§Ù† */
        :root {
            --accent: #3b82f6; --accent-glow: #60a5fa; --secondary: #8b5cf6;
            --bg: #0f172a; --card-bg: rgba(30, 41, 59, 0.7);
            --glass-border: rgba(255, 255, 255, 0.1);
            --text-main: #f1f5f9; --text-muted: #94a3b8;
        }
        /* 2. Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ§Øª */
        * { box-sizing: border-box; font-family: 'IBM Plex Sans Arabic', sans-serif; }
        html, body { height: 100%; margin: 0; background-color: var(--bg); color: var(--text-main); overflow-x: hidden; }

        /* Ø§Ù„Ø®Ù„ÙÙŠØ© Ø§Ù„Ù…ØªØ­Ø±ÙƒØ© */
        .ambient-light { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; pointer-events: none; overflow: hidden; }
        .light-blob { position: absolute; border-radius: 50%; filter: blur(80px); opacity: 0.4; animation: float 20s infinite alternate ease-in-out; }
        .blob-1 { top: -10%; left: -10%; width: 500px; height: 500px; background: var(--accent); animation-duration: 25s; }
        .blob-2 { bottom: -10%; right: -10%; width: 600px; height: 600px; background: var(--secondary); animation-duration: 30s; animation-delay: -5s; }
        .blob-3 { top: 40%; left: 40%; width: 300px; height: 300px; background: #06b6d4; opacity: 0.2; animation-duration: 20s; }
        @keyframes float { 0% { transform: translate(0, 0) scale(1); } 50% { transform: translate(50px, 50px) scale(1.1); } 100% { transform: translate(-30px, 20px) scale(0.9); } }

        /* Ø§Ù„Ù‡ÙŠØ¯Ø± */
        header { display: flex; align-items: center; justify-content: space-between; padding: 15px 5%; background: rgba(15, 23, 42, 0.6); backdrop-filter: blur(20px); border-bottom: 1px solid var(--glass-border); position: sticky; top: 0; z-index: 50; }
        .brand { display: flex; gap: 15px; align-items: center; }
        .logo { width: 50px; height: 50px; border-radius: 14px; background: linear-gradient(135deg, var(--accent), var(--secondary)); display: flex; align-items: center; justify-content: center; font-size: 24px; color: white; box-shadow: 0 0 20px rgba(59, 130, 246, 0.5); animation: pulse-glow 3s infinite; }
        @keyframes pulse-glow { 0%, 100% { box-shadow: 0 0 20px rgba(59, 130, 246, 0.5); } 50% { box-shadow: 0 0 35px rgba(139, 92, 246, 0.6); } }
        h1 { margin: 0; font-size: 20px; font-weight: 700; letter-spacing: -0.5px; }
        p.lead { margin: 2px 0 0; color: var(--text-muted); font-size: 13px; }
        
        /* Ø§Ù„ØªØ®Ø·ÙŠØ· ÙˆØ§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª */
        main { padding: 30px 20px; max-width: 1200px; margin: 0 auto; }
        .grid { display: grid; grid-template-columns: 350px 1fr; gap: 30px; }
        .card { background: var(--card-bg); backdrop-filter: blur(12px); border-radius: 16px; padding: 24px; border: 1px solid var(--glass-border); box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2); transition: transform 0.2s; }
        
        /* Ø§Ù„Ù†Ù…Ø§Ø°Ø¬ */
        label { font-size: 13px; color: var(--text-muted); display: block; margin-top: 16px; margin-bottom: 6px; font-weight: 500; }
        input, textarea, select { width: 100%; padding: 14px; border-radius: 12px; border: 1px solid var(--glass-border); background: rgba(15, 23, 42, 0.6); color: white; font-size: 14px; transition: all 0.3s; }
        input[type="file"] { padding: 10px; cursor: pointer; }
        input[type="file"]::file-selector-button { background: var(--accent); border: none; color: white; padding: 5px 10px; border-radius: 6px; margin-left: 10px; cursor: pointer; }
        input:focus, textarea:focus, select:focus { outline: none; border-color: var(--accent); box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2); background: rgba(15, 23, 42, 0.8); }
        textarea { min-height: 120px; resize: vertical; line-height: 1.6; }
        
        /* Ø§Ù„Ø£Ø²Ø±Ø§Ø± */
        button { background: linear-gradient(90deg, var(--accent), var(--secondary)); border: none; color: white; padding: 12px 20px; border-radius: 12px; font-weight: 600; cursor: pointer; transition: all 0.3s; display: inline-flex; align-items: center; gap: 8px; box-shadow: 0 4px 15px rgba(59, 130, 246, 0.3); }
        button:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(59, 130, 246, 0.5); }
        .btn-secondary { background: rgba(255,255,255,0.05) !important; box-shadow: none !important; border: 1px solid var(--glass-border); color: var(--text-muted) !important; }
        .btn-secondary:hover { background: rgba(255,255,255,0.1) !important; color: white !important; }
        
        /* Ø§Ù„Ø¨ÙˆØ³ØªØ§Øª */
        .posts { display: flex; flex-direction: column; gap: 20px; }
        .post { background: rgba(255, 255, 255, 0.03); border: 1px solid var(--glass-border); border-radius: 16px; padding: 20px; transition: all 0.3s; }
        .post:hover { background: rgba(255, 255, 255, 0.05); border-color: var(--accent); }
        .post strong { color: var(--accent-glow); font-size: 18px; display: block; margin-bottom: 4px; }
        .content-box { background: rgba(0,0,0,0.2); padding: 15px; border-radius: 10px; margin: 15px 0; font-family: monospace; line-height: 1.7; border-right: 3px solid var(--accent); white-space: pre-wrap; }
        .post-image { width: 100%; max-height: 400px; object-fit: cover; border-radius: 12px; margin-bottom: 15px; border: 1px solid var(--glass-border); }
        .chip { background: rgba(59, 130, 246, 0.15); color: var(--accent-glow); padding: 4px 10px; border-radius: 20px; font-size: 12px; border: 1px solid rgba(59, 130, 246, 0.3); }

        /* Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª */
        #notification { position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%) translateY(50px); background: #10b981; color: white; padding: 14px 30px; border-radius: 50px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); z-index: 1000; opacity: 0; transition: all 0.4s; font-weight: 600; display: flex; align-items: center; gap: 10px; }
        .show-notification { opacity: 1 !important; transform: translateX(-50%) translateY(0) !important; }
        
        @media (max-width: 900px) { .grid { grid-template-columns: 1fr; } header { flex-wrap: wrap; gap: 15px; justify-content: center; text-align: center; } .brand { flex-direction: column; gap: 10px; } }
    </style>
</head>
<body>

    <div class="ambient-light"><div class="light-blob blob-1"></div><div class="light-blob blob-2"></div><div class="light-blob blob-3"></div></div>
    <div id="notification">âœ… ØªÙ… Ø§Ù„Ø¹Ù…Ù„ÙŠØ© Ø¨Ù†Ø¬Ø§Ø­</div>

    <header>
        <div class="brand">
            <div class="logo">ğŸ’¡</div>
            <div><h1>ÙŠÙˆØ³Ù ÙˆØ§ Ù…ÙƒØ§Ø±ÙŠÙˆØ³</h1><p class="lead">Ù…Ù†ØµØ© Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ø¨Ø±ÙˆÙ…Ø¨ØªØ§Øª Ø§Ù„Ø°ÙƒÙŠØ©</p></div>
        </div>
        <div style="text-align: left;">
            <a href="https://wa.me/qr/NSX4N5ZH5U2JI1" class="chip" style="text-decoration:none; font-weight:bold;">ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø§Ù„Ù…ØµÙ…Ù… ğŸ“</a>
            <p style="margin: 3px 0 0 0; font-size: 13px; color: var(--text-muted);">**Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ù…Ø¹Ø±ÙØ© ØªØ²ÙŠØ¯Ù‡Ø§**</p>
        </div>
    </header>

    <main>
        <div class="grid">
            <aside>
                <div class="card" style="position:sticky; top: 100px;">
                    <h3 style="margin:0 0 15px 0; color:white; display:flex; align-items:center; gap:8px;"><span>âœ¨</span> Ø¥Ø¶Ø§ÙØ© Ø¨Ø±ÙˆÙ…Øª Ø¬Ø¯ÙŠØ¯</h3>
                    <label>Ø§Ø³Ù…Ùƒ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label><input id="author" type="text" placeholder="Ø£Ø­Ù…Ø¯..." />
                    <label>Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¨Ø±ÙˆÙ…Øª</label><input id="title" type="text" placeholder="Ù…Ø«Ø§Ù„: Ø®Ø·Ø© ØªØ³ÙˆÙŠÙ‚ÙŠØ©..." />
                    <label>Ù†Øµ Ø§Ù„Ø¨Ø±ÙˆÙ…Øª <span style="color:#ef4444">*</span></label><textarea id="prompt" placeholder="Ø§ÙƒØªØ¨ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¨Ø±ÙˆÙ…Øª Ù‡Ù†Ø§..."></textarea>
                    
                    <label>ØµÙˆØ±Ø© ØªÙˆØ¶ÙŠØ­ÙŠØ© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ - Ø£Ù‚ØµÙ‰ Ø­Ø¬Ù… 3MB)</label>
                    <input type="file" id="imageInput" accept="image/*" />

                    <label>Ø§Ù„ØªØµÙ†ÙŠÙ</label>
                    <select id="tag">
                        <option value="Ø¹Ø§Ù…">Ø¹Ø§Ù…</option><option value="ØªØ³ÙˆÙŠÙ‚">ØªØ³ÙˆÙŠÙ‚</option><option value="Ø¨Ø±Ù…Ø¬Ø©">Ø¨Ø±Ù…Ø¬Ø©</option><option value="ÙƒØªØ§Ø¨Ø©">ÙƒØªØ§Ø¨Ø© ÙˆÙ…Ø­ØªÙˆÙ‰</option><option value="ØªØµÙ…ÙŠÙ…">ØªØµÙ…ÙŠÙ… ÙˆØµÙˆØ±</option><option value="ØªØ¹Ù„ÙŠÙ…">ØªØ¹Ù„ÙŠÙ…</option>
                    </select>
                    <div style="height:25px"></div>
                    <div style="display:flex; gap:10px;">
                        <button id="publishBtn" style="flex:2">Ù†Ø´Ø± Ø§Ù„Ø¢Ù† ğŸš€</button>
                        <button id="clearBtn" class="btn-secondary" style="flex:1">Ù…Ø³Ø­</button>
                    </div>
                </div>
            </aside>

            <section>
                <div class="card" style="margin-bottom: 25px;">
                    <div style="display:flex; gap:10px; flex-wrap:wrap;">
                        <input id="searchInput" style="flex:2" type="text" placeholder="ğŸ” Ø§Ø¨Ø­Ø« Ø¹Ù† Ø£ÙŠ Ø´ÙŠØ¡..." />
                        <select id="filterTag" style="flex:1; min-width:150px;"><option value="">ÙƒÙ„ Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª</option></select>
                    </div>
                </div>
                <div id="postsContainer" class="posts">
                    <div style="text-align:center; padding:40px; color:var(--text-muted)">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨Ø±ÙˆÙ…Ø¨ØªØ§Øª...</div>
                </div>
                <div id="emptyState" style="display:none; text-align:center; padding:50px; opacity:0.7;">
                    <div style="font-size:40px; margin-bottom:10px;">ğŸ“­</div>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬ Ù…Ø·Ø§Ø¨Ù‚Ø©ØŒ ÙƒÙ† Ø£ÙˆÙ„ Ù…Ù† ÙŠÙ†Ø´Ø±!
                </div>
            </section>
        </div>
    </main>

    <footer style="text-align:center; padding:30px; font-size:13px; color:var(--text-muted); border-top:1px solid var(--glass-border); margin-top:30px;">
        &copy; 2025 Ù…ÙˆÙ‚Ø¹ ÙŠÙˆØ³Ù Ø£Ø­Ù…Ø¯ Ø®Ù„ÙŠÙØ© | Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø© <br> <span style="opacity:0.6">ØªÙ… Ø§Ù„ØªØ·ÙˆÙŠØ± Ø¨Ø­Ø¨ â¤ï¸</span>
    </footer>

    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>

    <script>
        // ==========================================
        // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ÙˆØªÙˆØµÙŠÙ„ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØ§Ù„Ù…ÙØªØ§Ø­ Ø§Ù„Ø³Ø±ÙŠ
        // ==========================================
        const firebaseConfig = {
            apiKey: "AIzaSyP016himjW1TiccHc0SiByPjOW0Vzv_Vs",
            authDomain: "yousefprompts-public-58082.firebaseapp.com",
            projectId: "yousefprompts-public-58082",
            storageBucket: "yousefprompts-public-58082.appspot.com",
            messagingSenderId: "1029355842188",
            appId: "1:1029355842188:web:b72df7144a0027c2e6da39",
            measurementId: "G-JY7D5F10YT"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const COLLECTION = 'prompts';
        const SECRET_CODE = 'Ù„ÙŠÙ‡';

        // ğŸŸ¢ğŸŸ¢ ØªÙ… ØªØ­Ø¯ÙŠØ« Ù‡Ø°Ø§ Ø§Ù„Ø³Ø·Ø± Ø¨Ù…ÙØªØ§Ø­ API Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ ğŸŸ¢ğŸŸ¢
        const IMGBB_API_KEY = '36084fdf44b90e0fc463761abb8c761c'; 
        // -------------------------------------------------------------------


        const el = id => document.getElementById(id);
        const escapeHtml = s => String(s).replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;');

        function showNotification(msg, isError = false) {
            const n = el('notification');
            n.innerHTML = isError ? `âŒ ${msg}` : `âœ… ${msg}`;
            n.style.background = isError ? '#ef4444' : '#10b981';
            n.classList.add('show-notification');
            setTimeout(() => n.classList.remove('show-notification'), 3000);
        }
        
        // Ø¯Ø§Ù„Ø© Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ù…Ù„Ù Ø¥Ù„Ù‰ Ù†Øµ Base64 Ù„Ù„Ø±ÙØ¹ Ø¥Ù„Ù‰ ImgBB
        const toBase64 = file => new Promise((resolve, reject) => {
            const reader = new FileReader();
            reader.readAsDataURL(file);
            reader.onload = () => resolve(reader.result.split(',')[1]); // Ù†Ø£Ø®Ø° Ø§Ù„Ø¬Ø²Ø¡ Base64 ÙÙ‚Ø·
            reader.onerror = error => reject(error);
        });

        // ==========================================
        // Ø§Ù„Ø¹Ø±Ø¶ ÙˆØ§Ù„Ø¬Ù„Ø¨ (Render)
        // ==========================================
        async function render() {
            const container = el('postsContainer');
            const searchVal = el('searchInput').value.toLowerCase();
            const filterVal = el('filterTag').value;

            try {
                const snapshot = await db.collection(COLLECTION).orderBy('createdAt', 'desc').limit(50).get();
                container.innerHTML = '';
                let hasResults = false;
                const allTags = new Set();

                snapshot.forEach(doc => {
                    const data = doc.data();
                    const p = { id: doc.id, ...data };
                    if (p.tag) allTags.add(p.tag);

                    const matchesSearch = !searchVal || (p.title||'').toLowerCase().includes(searchVal) || (p.prompt||'').toLowerCase().includes(searchVal) || (p.tag||'').toLowerCase().includes(searchVal);
                    const matchesFilter = !filterVal || p.tag === filterVal;

                    if (matchesSearch && matchesFilter) {
                        hasResults = true;
                        createPostElement(p, container);
                    }
                });

                el('emptyState').style.display = hasResults ? 'none' : 'block';
                if (!filterVal && allTags.size > 0) updateFilterOptions(allTags);

            } catch (err) {
                console.error(err);
                container.innerHTML = '<div style="text-align:center;color:red">Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</div>';
            }
        }

        function createPostElement(p, container) {
            const date = p.createdAt?.toDate ? p.createdAt.toDate().toLocaleDateString('ar-EG') : 'Ø§Ù„Ø¢Ù†';
            const div = document.createElement('div');
            div.className = 'post';
            
            let imageHtml = '';
            // Ø¹Ø±Ø¶ Ø§Ù„ØµÙˆØ±Ø© Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø±Ø§Ø¨Ø· (URL)
            if (p.imageUrl) {
                imageHtml = `<img src="${p.imageUrl}" class="post-image" alt="ØµÙˆØ±Ø©" loading="lazy" />`;
            }

            div.innerHTML = `
                <div style="display:flex; justify-content:space-between; align-items:flex-start; margin-bottom:10px;">
                    <div>
                        <strong>${escapeHtml(p.title || 'Ø¨Ø¯ÙˆÙ† Ø¹Ù†ÙˆØ§Ù†')}</strong>
                        <div style="font-size:12px; color:var(--text-muted); margin-top:4px;">ğŸ‘¤ ${escapeHtml(p.author || 'Ù…Ø¬Ù‡ÙˆÙ„')} &bull; ğŸ“… ${date}</div>
                    </div>
                    <span class="chip">${escapeHtml(p.tag || 'Ø¹Ø§Ù…')}</span>
                </div>
                ${imageHtml}
                <div class="content-box">${escapeHtml(p.prompt)}</div>
                <div style="display:flex; gap:8px; flex-wrap:wrap; margin-top:15px;">
                    <button onclick="copyText('${p.id}', this)" style="flex:1; justify-content:center;">Ù†Ø³Ø® ğŸ“‹</button>
                    <button class="btn-secondary" onclick="addLike('${p.id}')">â¤ï¸ ${p.likes || 0}</button>
                    <button class="btn-secondary" onclick="editPost('${p.id}')">âœï¸</button>
                    <button class="btn-secondary" style="color:#ef4444 !important; border-color:#ef4444" onclick="deletePost('${p.id}')">ğŸ—‘ï¸</button>
                </div>
            `;
            container.appendChild(div);
        }

        function updateFilterOptions(tagsSet) {
            const select = el('filterTag');
            const currentVal = select.value;
            let opts = '<option value="">ÙƒÙ„ Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª</option>';
            ['Ø¹Ø§Ù…', 'ØªØ³ÙˆÙŠÙ‚', 'Ø¨Ø±Ù…Ø¬Ø©', 'ÙƒØªØ§Ø¨Ø©', 'ØªØµÙ…ÙŠÙ…', 'ØªØ¹Ù„ÙŠÙ…'].forEach(t => tagsSet.add(t));
            Array.from(tagsSet).sort().forEach(tag => opts += `<option value="${tag}">${tag}</option>`);
            select.innerHTML = opts;
            select.value = currentVal;
        }

        // ==========================================
        // Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª (Actions) - Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø© Ø¹Ø¨Ø± ImgBB
        // ==========================================
        el('publishBtn').addEventListener('click', async () => {
            const btn = el('publishBtn');
            const promptVal = el('prompt').value.trim();
            const imageFile = el('imageInput').files[0];
            const MAX_SIZE_MB = 3 * 1024 * 1024;
            
            if (!promptVal) return showNotification('Ø§Ù„Ø±Ø¬Ø§Ø¡ ÙƒØªØ§Ø¨Ø© Ø§Ù„Ø¨Ø±ÙˆÙ…Øª Ø£ÙˆÙ„Ø§Ù‹', true);
            if (IMGBB_API_KEY === 'YOUR_IMGBB_API_KEY' || IMGBB_API_KEY.length < 10) return showNotification('Ø®Ø·Ø£: Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ù…ÙØªØ§Ø­ ImgBB API.', true);

            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø­Ø¬Ù…
            if (imageFile && imageFile.size > MAX_SIZE_MB) {
                return showNotification(`Ø­Ø¬Ù… Ø§Ù„ØµÙˆØ±Ø© ÙƒØ¨ÙŠØ± Ø¬Ø¯Ø§Ù‹! Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ 3MB`, true);
            }

            btn.disabled = true; btn.innerText = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø±ÙØ¹ ÙˆØ§Ù„Ù†Ø´Ø±...';

            try {
                let finalImageUrl = null;

                // 1. Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø© Ø¥Ù„Ù‰ ImgBB
                if (imageFile) {
                    const base64Data = await toBase64(imageFile);
                    
                    const formData = new FormData();
                    formData.append("image", base64Data); 

                    const response = await fetch(`https://api.imgbb.com/1/upload?key=${IMGBB_API_KEY}`, {
                        method: 'POST',
                        body: formData
                    });
                    
                    const result = await response.json();

                    if (result.success) {
                        finalImageUrl = result.data.url; 
                    } else {
                        throw new Error(result.error.message || 'ÙØ´Ù„ Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø© Ù„Ø®Ø¯Ù…Ø© ImgBB');
                    }
                }

                // 2. Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Firestore (Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø±Ø§Ø¨Ø· ÙÙ‚Ø·)
                await db.collection(COLLECTION).add({
                    author: el('author').value.trim() || 'Ù…Ø¬Ù‡ÙˆÙ„',
                    title: el('title').value.trim(),
                    prompt: promptVal,
                    tag: el('tag').value,
                    imageUrl: finalImageUrl, 
                    likes: 0,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                });
                
                showNotification('ØªÙ… Ù†Ø´Ø± Ø§Ù„Ø¨Ø±ÙˆÙ…Øª ÙˆØ§Ù„ØµÙˆØ±Ø© Ø¨Ù†Ø¬Ø§Ø­!');
                el('prompt').value = ''; el('title').value = ''; el('imageInput').value = '';
                render();

            } catch (e) {
                console.error(e);
                showNotification(`Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ù†Ø´Ø±: ${e.message}`, true);
            }
            btn.disabled = false; btn.innerText = 'Ù†Ø´Ø± Ø§Ù„Ø¢Ù† ğŸš€';
        });

        el('clearBtn').onclick = () => { el('prompt').value=''; el('title').value=''; el('author').value=''; el('imageInput').value = ''; };
        
        function copyText(id, btnElement) {
            const postDiv = btnElement.closest('.post');
            const text = postDiv.querySelector('.content-box').innerText;
            navigator.clipboard.writeText(text).then(() => {
                const originalText = btnElement.innerText;
                btnElement.innerText = 'ØªÙ… Ø§Ù„Ù†Ø³Ø®! âœ…';
                setTimeout(() => btnElement.innerText = originalText, 2000);
                showNotification('ØªÙ… Ù†Ø³Ø® Ø§Ù„Ù†Øµ Ù„Ù„Ø­Ø§ÙØ¸Ø©');
            });
        }

        async function addLike(id) { await db.collection(COLLECTION).doc(id).update({ likes: firebase.firestore.FieldValue.increment(1) }); render(); }
        
        async function deletePost(id) {
            const code = prompt('Ø£Ø¯Ø®Ù„ Ø§Ù„Ø±Ù…Ø² Ø§Ù„Ø³Ø±ÙŠ Ù„Ù„Ø­Ø°Ù:');
            if (code !== SECRET_CODE) return alert('Ø§Ù„Ø±Ù…Ø² Ø®Ø§Ø·Ø¦!');
            if(!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ØŸ')) return;
            
            await db.collection(COLLECTION).doc(id).delete();
            showNotification('ØªÙ… Ø§Ù„Ø­Ø°Ù');
            render();
        }

        async function editPost(id) {
            const code = prompt('Ø£Ø¯Ø®Ù„ Ø§Ù„Ø±Ù…Ø² Ø§Ù„Ø³Ø±ÙŠ Ù„Ù„ØªØ¹Ø¯ÙŠÙ„:');
            if (code !== SECRET_CODE) return alert('Ø§Ù„Ø±Ù…Ø² Ø®Ø§Ø·Ø¦!');
            const doc = await db.collection(COLLECTION).doc(id).get();
            const newPrompt = prompt('Ø¹Ø¯Ù„ Ø§Ù„Ù†Øµ:', doc.data().prompt);
            if(newPrompt) {
                await db.collection(COLLECTION).doc(id).update({ prompt: newPrompt });
                render(); showNotification('ØªÙ… Ø§Ù„ØªØ¹Ø¯ÙŠÙ„');
            }
        }

        el('searchInput').addEventListener('input', () => render());
        el('filterTag').addEventListener('change', () => render());
        render();
    </script>
</body>
</html>