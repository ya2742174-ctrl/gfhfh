<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>منجزاتي اليومية</title>
  <style>
    :root {
      --bg: #0b1020;
      --panel: #131a31;
      --panel-2: #1a2340;
      --text: #f2f5ff;
      --muted: #9ca7c7;
      --primary: #6d7cff;
      --success: #35d48d;
      --danger: #ff6b7a;
      --radius: 16px;
    }

    * { box-sizing: border-box; }
    body {
      margin: 0;
      min-height: 100vh;
      font-family: "Segoe UI", Tahoma, sans-serif;
      background: radial-gradient(circle at top, #1b2550 0%, var(--bg) 60%);
      color: var(--text);
      display: flex;
      justify-content: center;
      padding: 20px 12px;
    }

    .app {
      width: 100%;
      max-width: 440px;
      background: rgba(11, 16, 32, 0.65);
      border: 1px solid rgba(255,255,255,0.08);
      backdrop-filter: blur(12px);
      border-radius: 24px;
      padding: 16px;
      box-shadow: 0 20px 45px rgba(0,0,0,.35);
    }

    h1 {
      margin: 0;
      font-size: 1.4rem;
    }

    .subtitle {
      color: var(--muted);
      margin: 4px 0 14px;
      font-size: .95rem;
    }

    .card {
      background: var(--panel);
      border-radius: var(--radius);
      padding: 12px;
      margin-bottom: 12px;
      border: 1px solid rgba(255,255,255,0.06);
    }

    .row { display: flex; gap: 8px; }
    input, select, button {
      border: 0;
      border-radius: 12px;
      font-size: .95rem;
    }

    input, select {
      background: var(--panel-2);
      color: var(--text);
      width: 100%;
      padding: 12px;
      outline: none;
      border: 1px solid transparent;
    }

    input:focus, select:focus {
      border-color: var(--primary);
    }

    button {
      padding: 11px 12px;
      font-weight: 600;
      cursor: pointer;
      transition: .18s ease;
    }

    .btn-primary {
      background: linear-gradient(135deg, var(--primary), #8a64ff);
      color: white;
      min-width: 95px;
    }

    .btn-primary:hover { transform: translateY(-1px); }

    .filters {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 8px;
    }

    .chip {
      background: var(--panel-2);
      color: var(--muted);
      border: 1px solid rgba(255,255,255,0.08);
      padding: 9px;
    }

    .chip.active {
      color: #fff;
      border-color: var(--primary);
      background: rgba(109,124,255,.25);
    }

    .stats {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 8px;
      text-align: center;
      font-size: .85rem;
    }

    .stats strong {
      display: block;
      font-size: 1.1rem;
      margin-bottom: 4px;
    }

    .tasks {
      display: flex;
      flex-direction: column;
      gap: 8px;
      max-height: 50vh;
      overflow: auto;
      padding-inline-start: 2px;
    }

    .task {
      display: grid;
      grid-template-columns: auto 1fr auto;
      align-items: center;
      gap: 10px;
      background: var(--panel);
      border-radius: 14px;
      padding: 10px;
      border: 1px solid rgba(255,255,255,0.06);
    }

    .task.done {
      opacity: .75;
      border-color: rgba(53,212,141,.45);
    }

    .task-title {
      margin: 0;
      font-weight: 600;
      font-size: .95rem;
    }

    .task.done .task-title {
      text-decoration: line-through;
      color: #b7c2e6;
    }

    .task-meta {
      margin-top: 4px;
      color: var(--muted);
      font-size: .8rem;
    }

    .icon-btn {
      background: transparent;
      color: var(--muted);
      border: 1px solid rgba(255,255,255,0.11);
      padding: 6px 8px;
      font-size: .83rem;
    }

    .icon-btn.delete { color: var(--danger); border-color: rgba(255,107,122,.45); }
    .check {
      width: 20px;
      height: 20px;
      accent-color: var(--success);
      cursor: pointer;
    }

    .empty {
      text-align: center;
      color: var(--muted);
      padding: 22px 8px;
      font-size: .9rem;
    }
  </style>
</head>
<body>
  <main class="app">
    <header>
      <h1>✅ منجزاتي اليومية</h1>
      <p class="subtitle">تطبيق مهام بسيط للموبايل (يعمل بدون تسجيل دخول)</p>
    </header>

    <section class="card">
      <div class="row">
        <input id="taskInput" type="text" placeholder="اكتب المهمة..." />
        <button class="btn-primary" id="addBtn">إضافة</button>
      </div>
      <div class="row" style="margin-top:8px;">
        <input id="dateInput" type="date" />
        <select id="priorityInput">
          <option value="منخفضة">منخفضة</option>
          <option value="متوسطة" selected>متوسطة</option>
          <option value="عالية">عالية</option>
        </select>
      </div>
    </section>

    <section class="card filters">
      <button class="chip active" data-filter="all">الكل</button>
      <button class="chip" data-filter="today">اليوم</button>
      <button class="chip" data-filter="pending">غير مكتملة</button>
    </section>

    <section class="card stats">
      <div><strong id="allCount">0</strong>إجمالي</div>
      <div><strong id="doneCount">0</strong>منجزة</div>
      <div><strong id="pendingCount">0</strong>متبقية</div>
    </section>

    <section id="tasks" class="tasks"></section>
  </main>

  <script>
    const taskInput = document.getElementById('taskInput');
    const dateInput = document.getElementById('dateInput');
    const priorityInput = document.getElementById('priorityInput');
    const addBtn = document.getElementById('addBtn');
    const tasksEl = document.getElementById('tasks');
    const chips = document.querySelectorAll('.chip');

    const allCount = document.getElementById('allCount');
    const doneCount = document.getElementById('doneCount');
    const pendingCount = document.getElementById('pendingCount');

    const STORAGE_KEY = 'dailyTasks';
    let filter = 'all';
    let tasks = loadTasks();

    function loadTasks() {
      try {
        const raw = JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]');
        return Array.isArray(raw) ? raw : [];
      } catch {
        return [];
      }
    }

    function saveTasks() {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(tasks));
    }

    function createId() {
      return (window.crypto && crypto.randomUUID)
        ? crypto.randomUUID()
        : `${Date.now()}-${Math.random().toString(16).slice(2)}`;
    }

    function isToday(dateStr) {
      if (!dateStr) return false;
      const today = new Date().toISOString().slice(0, 10);
      return dateStr === today;
    }

    function filteredTasks() {
      if (filter === 'today') return tasks.filter(t => isToday(t.date));
      if (filter === 'pending') return tasks.filter(t => !t.done);
      return tasks;
    }

    function updateStats() {
      const done = tasks.filter(t => t.done).length;
      allCount.textContent = tasks.length;
      doneCount.textContent = done;
      pendingCount.textContent = tasks.length - done;
    }

    function makeButton(text, className, action, id) {
      const btn = document.createElement('button');
      btn.className = className;
      btn.textContent = text;
      btn.dataset.action = action;
      btn.dataset.id = id;
      return btn;
    }

    function createTaskElement(task) {
      const article = document.createElement('article');
      article.className = `task ${task.done ? 'done' : ''}`;

      const check = document.createElement('input');
      check.className = 'check';
      check.type = 'checkbox';
      check.checked = !!task.done;
      check.dataset.action = 'toggle';
      check.dataset.id = task.id;

      const body = document.createElement('div');
      const title = document.createElement('p');
      title.className = 'task-title';
      title.textContent = task.title;

      const meta = document.createElement('div');
      meta.className = 'task-meta';
      meta.textContent = `${task.date || 'بدون تاريخ'} • الأولوية: ${task.priority || 'متوسطة'}`;

      body.append(title, meta);

      const actions = document.createElement('div');
      actions.className = 'row';
      actions.append(
        makeButton('تعديل', 'icon-btn', 'edit', task.id),
        makeButton('حذف', 'icon-btn delete', 'delete', task.id)
      );

      article.append(check, body, actions);
      return article;
    }

    function render() {
      updateStats();
      const items = filteredTasks();
      tasksEl.innerHTML = '';

      if (!items.length) {
        const empty = document.createElement('div');
        empty.className = 'empty';
        empty.textContent = 'لا توجد مهام في هذا القسم ✨';
        tasksEl.appendChild(empty);
        return;
      }

      items.forEach(task => tasksEl.appendChild(createTaskElement(task)));
    }

    function addTask() {
      const title = taskInput.value.trim();
      if (!title) return;

      tasks.unshift({
        id: createId(),
        title,
        date: dateInput.value,
        priority: priorityInput.value,
        done: false
      });

      taskInput.value = '';
      saveTasks();
      render();
    }

    function toggleTask(id) {
      tasks = tasks.map(t => t.id === id ? { ...t, done: !t.done } : t);
      saveTasks();
      render();
    }

    function deleteTask(id) {
      tasks = tasks.filter(t => t.id !== id);
      saveTasks();
      render();
    }

    function editTask(id) {
      const task = tasks.find(t => t.id === id);
      if (!task) return;

      const title = prompt('عدّل نص المهمة:', task.title);
      if (!title || !title.trim()) return;

      task.title = title.trim();
      saveTasks();
      render();
    }

    chips.forEach(chip => {
      chip.addEventListener('click', () => {
        chips.forEach(c => c.classList.remove('active'));
        chip.classList.add('active');
        filter = chip.dataset.filter;
        render();
      });
    });

    addBtn.addEventListener('click', addTask);
    taskInput.addEventListener('keydown', e => {
      if (e.key === 'Enter') addTask();
    });

    tasksEl.addEventListener('click', event => {
      const target = event.target;
      if (!(target instanceof HTMLElement)) return;
      const action = target.dataset.action;
      const id = target.dataset.id;
      if (!action || !id) return;
      if (action === 'edit') editTask(id);
      if (action === 'delete') deleteTask(id);
    });

    tasksEl.addEventListener('change', event => {
      const target = event.target;
      if (!(target instanceof HTMLInputElement)) return;
      if (target.dataset.action === 'toggle' && target.dataset.id) {
        toggleTask(target.dataset.id);
      }
    });

    render();
  </script>
</body>
</html>
